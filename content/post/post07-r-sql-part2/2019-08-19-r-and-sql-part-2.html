---
title: "R and SQL (Part 2)"
author: ''
date: '2019-08-20'
comments: yes
categories: []
slug: r-and-sql-part2
tags: []
thumbnailImage: //res.cloudinary.com/ddjmrpbw4/image/upload/w_500,c_pad,fl_ignore_aspect_ratio,b_white/v1563498573/06%20R%20SQL/r_to_sql_thumb1.png
thumbnailImagePosition: left
Summary: Part 2 of a series that examines parallels between SQL and R. Here we look at joins, grouped data and subqueries.
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>


<p><em>This is part 2 of a series of posts demonstrating how equivalent analysis can be carried out in SQL and R. Here we look at joins, grouped data, and subqueries.</em></p>
<hr>
<!--more--->
<p>{{<alert warning>}}
Please note that this post is currently under construction. More sections will be added over time.<br />
{{</alert>}}</p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In <a href="https://www.stevedoogue.com/2019/08/r-and-sql/">Part 1</a> of this series we looked at the similarities between SQL and R when <em>selecting</em>, <em>sorting</em> and <em>filtering</em> data. In this second part we are going to extend the comparison to include <em>joins</em>, <em>grouped data</em> and <em>subqueries</em>.</p>
</div>
<div id="contents" class="section level1">
<h1>Contents</h1>
<ul>
<li><a href="#setup"><strong>The data</strong></a></li>
<li><a href="#part1"><strong>1. Common joins</strong></a>
<ul>
<li><a href="#part1_1"><strong>1.1 Inner join</strong></a></li>
<li><a href="#part1_2"><strong>1.2 Left join</strong></a></li>
<li><a href="#part1_3"><strong>1.3 Right join</strong></a></li>
<li><a href="#part1_4"><strong>1.4 Full join</strong></a></li>
</ul></li>
<li><a href="#part2"><strong>2. Grouped data</strong></a>
<ul>
<li><a href="#part2_1"><strong>2.1 Summarizing grouped data</strong></a></li>
<li><a href="#part2_2"><strong>2.2 Filtering grouped data</strong></a>
<hr></li>
</ul></li>
</ul>
</div>
<div id="setup" class="section level1">
<h1>The data</h1>
<p>We will use the same sample dataset from <a href="http://www.mysqltutorial.org/">mysqltutorial.org</a> that was used in the first part of this post, as described <a href="https://www.stevedoogue.com/2019/08/r-and-sql/#the-sample-dataset">here</a>. The schema is reproduced below for ease of reference:
<br><br />
<br></p>
<center>
<img src="https://res.cloudinary.com/ddjmrpbw4/image/upload/v1563847454/06%20R%20SQL/schema.png" style="width:90.0%" />
</center>
<p>Instructions on how to load the sample dataset into MySQL and R were provided <a href="https://www.stevedoogue.com/2019/08/r-and-sql/#setting-up">here</a>.<br />
<br></p>
<a href="#contents"><em>(Top)</em></a>
<hr>
</div>
<div id="part1" class="section level1">
<h1>1. Common joins</h1>
<p>A join allows you to combine variables or columns from two tables. It first matches observations by their keys, then copies across variables from one table to another.</p>
<p>To understand joins, we are going to use the explanation provided by Hadley Wickham in <a href="https://r4ds.had.co.nz/relational-data.html#understanding-joins">R for Data Science</a>, and the excellent <a href="https://github.com/gadenbuie/tidyexplain">animations</a> that were produced by Garrick Aden-Buie. These illustrate the different ways that we can join the data in table <em>x</em>, below, with the data in table <em>y</em>. The colored columns represent the “key” variable that is used to match the rows between the tables.</p>
<center>
<img src="https://res.cloudinary.com/ddjmrpbw4/image/upload/v1566488664/07%20R%20SQL%20p2/join_original.png" style="width:65.0%" />
</center>
<p>This section looks at four common joins:</p>
<ul>
<li>Inner join</li>
<li>Left join</li>
<li>Right join</li>
<li>Full join</li>
</ul>
<a href="#contents"><em>(Top)</em></a>
<hr>
<div id="part1_1" class="section level4">
<h4>1.1 Inner join</h4>
<p>An inner join shows all rows from <em>x</em> where there are matching values in <em>y</em>, and all columns from <em>x</em> and <em>y</em>:</p>
<center>
<img src="https://res.cloudinary.com/ddjmrpbw4/image/upload/v1566493838/07%20R%20SQL%20p2/join_inner_cropped.gif" style="width:60.0%" />
</center>
<div id="example-1.1a" class="section level5">
<h5>Example 1.1a:</h5>
<p>Say we want to list the name of every employee from the <em>employees</em> table who has one or more customers recorded in the <em>customers</em> table.</p>
<p>This is an example of an inner join, as we only want records that have a match in both tables. In this case our keys - the columns that we will be matching - are the <em>employeeNumber</em> in the <em>employees</em> table and the <em>salesRepEmployeeNumber</em> in the <em>customers</em> table.</p>
<p>We would like the code to return the following information:</p>
<ul>
<li>employee number</li>
<li>employee first name</li>
<li>employee second name</li>
<li>customer name(s)</li>
</ul>
<p><em>With SQL:</em></p>
<p>To do this in SQL we would use <code>INNER JOIN</code>, followed by the name of the table we are joining to. We then use <code>ON</code> to specify the names of the columns (keys) that are being used to match the data in the two tables:</p>
<pre class="markdown"><code>SELECT 
  employees.employeeNumber, 
  employees.lastName, 
  employees.firstName, 
  customers.customerName
FROM   
  employees 
  INNER JOIN 
  customers 
    ON employees.employeeNumber = customers.salesRepEmployeeNumber
ORDER BY 
  lastName, customerName</code></pre>
<p>Note that we’ve specified the table from which each column is taken; for example, using <code>employees.employeeNumber</code> rather than just <code>employeeNumber</code>. This is necessary in cases where the same column name appears in more than one table. In this particular example, we could have written the code without the table prefixes, but they have been included for illustrative purposes.</p>
<p><em>With R:</em></p>
<p>The same join could be carried out in R using the <code>inner_join</code> function. This includes the <code>by</code> argument (equivalent to SQL’s <code>ON</code>), in which we list the names of the keys:</p>
<pre class="r"><code>employees %&gt;%   #left-hand table
  #after &#39;by&#39; we list the key from the left-hand table first:
  inner_join(customers, by = c(&quot;employeeNumber&quot; = &quot;salesRepEmployeeNumber&quot;)) %&gt;%
  select(employeeNumber, lastName, firstName, customerName) %&gt;% 
  arrange(lastName, customerName)</code></pre>
Both the SQL and R code above returns the following 100 records. Note that each employee’s name appears more than once if they have more than one customer.
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
employeeNumber
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
lastName
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
firstName
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
customerName
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
1337
</td>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
</tr>
<tr>
<td style="text-align:right;">
1337
</td>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
La Corne D’abondance, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1337
</td>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Lyon Souveniers
</td>
</tr>
<tr>
<td style="text-align:right;">
1337
</td>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Marseille Mini Autos
</td>
</tr>
<tr>
<td style="text-align:right;">
1337
</td>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Reims Collectables
</td>
</tr>
<tr>
<td style="text-align:right;">
1337
</td>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Saveley &amp; Henriot, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Double Decker Gift Stores, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
giftsbymail.co.uk
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Oulu Toy Supplies, Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Stylish Desk Decors, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Suominen Souveniers
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Toys of Finland, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1501
</td>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
UK Collectables, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Amica Models &amp; Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Danish Wholesale Imports
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Frau da Collezione
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Heintze Collectables
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
L’ordine Souveniers
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Mini Auto Werke
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Petit Auto
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Rovelli Gifts
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Royale Belge
</td>
</tr>
<tr>
<td style="text-align:right;">
1401
</td>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Salzburg Collectables
</td>
</tr>
<tr>
<td style="text-align:right;">
1188
</td>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Cambridge Collectables Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1188
</td>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Classic Gift Ideas, Inc
</td>
</tr>
<tr>
<td style="text-align:right;">
1188
</td>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Collectables For Less Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1188
</td>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Diecast Collectables
</td>
</tr>
<tr>
<td style="text-align:right;">
1188
</td>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Mini Creations Ltd. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1188
</td>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Online Mini Collectables
</td>
</tr>
<tr>
<td style="text-align:right;">
1611
</td>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1611
</td>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1611
</td>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1611
</td>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
</tr>
<tr>
<td style="text-align:right;">
1611
</td>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Souveniers And Things Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1702
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
CAF Imports
</td>
</tr>
<tr>
<td style="text-align:right;">
1702
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Corrida Auto Replicas, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1702
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Enaco Distributors
</td>
</tr>
<tr>
<td style="text-align:right;">
1702
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Iberia Gift Imports, Corp. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1702
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Precious Collectables
</td>
</tr>
<tr>
<td style="text-align:right;">
1702
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Vida Sport, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1370
</td>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
</tr>
<tr>
<td style="text-align:right;">
1370
</td>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Atelier graphique
</td>
</tr>
<tr>
<td style="text-align:right;">
1370
</td>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Auto Associés &amp; Cie.
</td>
</tr>
<tr>
<td style="text-align:right;">
1370
</td>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Daedalus Designs Imports
</td>
</tr>
<tr>
<td style="text-align:right;">
1370
</td>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Euro+ Shopping Channel
</td>
</tr>
<tr>
<td style="text-align:right;">
1370
</td>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
La Rochelle Gifts
</td>
</tr>
<tr>
<td style="text-align:right;">
1370
</td>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Mini Caravy
</td>
</tr>
<tr>
<td style="text-align:right;">
1165
</td>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Corporate Gift Ideas Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1165
</td>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Mini Gifts Distributors Ltd. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1165
</td>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Mini Wheels Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1165
</td>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Signal Collectibles Ltd. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1165
</td>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Technics Stores Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1165
</td>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
The Sharp Gifts Warehouse
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Bavarian Collectables Imports, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Clover Collections, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Herkku Gifts
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Norway Gifts By Mail, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Scandinavian Gift Ideas
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Toms Spezialitäten, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1504
</td>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Volvo Model Replicas, Co
</td>
</tr>
<tr>
<td style="text-align:right;">
1612
</td>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Down Under Souveniers, Inc
</td>
</tr>
<tr>
<td style="text-align:right;">
1612
</td>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Extreme Desk Decorations, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1612
</td>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
GiftsForHim.com
</td>
</tr>
<tr>
<td style="text-align:right;">
1612
</td>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Handji Gifts&amp; Co
</td>
</tr>
<tr>
<td style="text-align:right;">
1612
</td>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Kelly’s Gift Shop
</td>
</tr>
<tr>
<td style="text-align:right;">
1621
</td>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Cruz &amp; Sons Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1621
</td>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Dragon Souveniers, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1621
</td>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
King Kong Collectables, Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1621
</td>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Osaka Souveniers Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1621
</td>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Tokyo Collectables, Ltd
</td>
</tr>
<tr>
<td style="text-align:right;">
1216
</td>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1216
</td>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Diecast Classics Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1216
</td>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
FunGiftIdeas.com
</td>
</tr>
<tr>
<td style="text-align:right;">
1216
</td>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Gifts4AllAges.com
</td>
</tr>
<tr>
<td style="text-align:right;">
1216
</td>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Marta’s Replicas Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1216
</td>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Online Diecast Creations Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1166
</td>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Boards &amp; Toys Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1166
</td>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Collectable Mini Designs Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1166
</td>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Men ‘R’ US Retailers, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1166
</td>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Signal Gift Stores
</td>
</tr>
<tr>
<td style="text-align:right;">
1166
</td>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Toys4GrownUps.com
</td>
</tr>
<tr>
<td style="text-align:right;">
1166
</td>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
West Coast Collectables Co. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1286
</td>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
American Souvenirs Inc
</td>
</tr>
<tr>
<td style="text-align:right;">
1286
</td>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Classic Legends Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1286
</td>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Microscale Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1286
</td>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Muscle Machine Inc
</td>
</tr>
<tr>
<td style="text-align:right;">
1286
</td>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Québec Home Shopping Network
</td>
</tr>
<tr>
<td style="text-align:right;">
1286
</td>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Super Scale Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1286
</td>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Vitachrome Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Canadian Gift Exchange Network
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Gift Depot Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Gift Ideas Corp. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Land of Toys Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Mini Classics
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Motor Mint Distributors Inc. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Royal Canadian Collectables, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:right;">
1323
</td>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Tekni Collectables Inc. 
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="example-1.1b" class="section level5">
<h5>Example 1.1b:</h5>
<p>Say that we wanted to list every customer from the <em>customers</em> table who has one or more orders in the <em>orders</em> table.</p>
<p>This is another example of an inner join, this time matching records using the ‘customerNumber’ column as our key, which is the same in both tables.</p>
<p>We want the query to return the following information:</p>
<ul>
<li>customer number</li>
<li>customer name</li>
<li>order number</li>
<li>current order status</li>
</ul>
<p><em>With SQL:</em></p>
<p>The fact that the same column name is used in both tables means we can simplify our code with <code>USING</code> instead of <code>ON</code>, as follows:</p>
<pre class="markdown"><code>SELECT 
  c.customerNumber, 
  c.customerName, 
  o.orderNumber, 
  o.status
FROM
  customers AS c 
  INNER JOIN 
  orders AS o
    USING (customerNumber)
ORDER BY
  customerName</code></pre>
<p>This simplifies the code as we only need to list one column after <code>USING</code>.</p>
<p>In the example above, we’ve also used <a href="http://www.mysqltutorial.org/mysql-alias/">aliases</a> in place of the full table names, which further simplifies the code. This has assigned the short name ‘c’ to the ‘customers’ table and ‘o’ to the ‘orders’ table. This is done with the keyword <code>AS</code>, though even this could be excluded. Aliases makes the code shorter and easier to read.</p>
<p><em>With R:</em></p>
<p>The equivalent R code is shown below. Note that we now only need to specify the one column name in the <code>by</code> argument.</p>
<pre class="r"><code>customers %&gt;% 
  inner_join(orders, by = &quot;customerNumber&quot;) %&gt;%
  select(customerNumber, customerName, orderNumber, status) %&gt;% 
  arrange(customerName)</code></pre>
<p><br></p>
This code returns 326 rows, the first 50 of which are shown below:
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
customerNumber
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
customerName
</th>
<th style="text-align:right;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
orderNumber
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
status
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
242
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
<td style="text-align:right;">
10136
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
242
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
<td style="text-align:right;">
10178
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
242
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
<td style="text-align:right;">
10397
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
249
</td>
<td style="text-align:left;">
Amica Models &amp; Co. 
</td>
<td style="text-align:right;">
10280
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
249
</td>
<td style="text-align:left;">
Amica Models &amp; Co. 
</td>
<td style="text-align:right;">
10293
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10148
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10169
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10370
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10391
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
Atelier graphique
</td>
<td style="text-align:right;">
10123
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
Atelier graphique
</td>
<td style="text-align:right;">
10298
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
Atelier graphique
</td>
<td style="text-align:right;">
10345
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
471
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
<td style="text-align:right;">
10193
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
471
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
<td style="text-align:right;">
10265
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
471
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
<td style="text-align:right;">
10415
</td>
<td style="text-align:left;">
Disputed
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10120
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10125
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10223
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10342
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10347
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
<td style="text-align:right;">
10152
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
<td style="text-align:right;">
10174
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
<td style="text-align:right;">
10374
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
198
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
<td style="text-align:right;">
10130
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
198
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
<td style="text-align:right;">
10290
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
198
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
<td style="text-align:right;">
10352
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
256
</td>
<td style="text-align:left;">
Auto Associés &amp; Cie.
</td>
<td style="text-align:right;">
10216
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
256
</td>
<td style="text-align:left;">
Auto Associés &amp; Cie.
</td>
<td style="text-align:right;">
10304
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
406
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
<td style="text-align:right;">
10211
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
406
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
<td style="text-align:right;">
10252
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
406
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
<td style="text-align:right;">
10402
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
<td style="text-align:right;">
10110
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
<td style="text-align:right;">
10306
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
<td style="text-align:right;">
10332
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10103
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10158
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10309
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10325
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
415
</td>
<td style="text-align:left;">
Bavarian Collectables Imports, Co. 
</td>
<td style="text-align:right;">
10296
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10101
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10230
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10300
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10323
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
219
</td>
<td style="text-align:left;">
Boards &amp; Toys Co. 
</td>
<td style="text-align:right;">
10154
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
219
</td>
<td style="text-align:left;">
Boards &amp; Toys Co. 
</td>
<td style="text-align:right;">
10376
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
344
</td>
<td style="text-align:left;">
CAF Imports
</td>
<td style="text-align:right;">
10177
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
344
</td>
<td style="text-align:left;">
CAF Imports
</td>
<td style="text-align:right;">
10231
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
173
</td>
<td style="text-align:left;">
Cambridge Collectables Co. 
</td>
<td style="text-align:right;">
10228
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
173
</td>
<td style="text-align:left;">
Cambridge Collectables Co. 
</td>
<td style="text-align:right;">
10249
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
202
</td>
<td style="text-align:left;">
Canadian Gift Exchange Network
</td>
<td style="text-align:right;">
10206
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
</tbody>
</table>
</div>
<a href="#contents"><em>(Top)</em></a>
<hr>
</div>
</div>
<div id="part1_2" class="section level4">
<h4>1.2 Left join</h4>
<p>A left join (or outer left join) returns all rows from <em>x</em>, and all columns from <em>x</em> and <em>y</em>. Rows in <em>x</em> with no match in <em>y</em> will have NA or NULL values in the new columns.<br />
<br></p>
<center>
<img src="https://res.cloudinary.com/ddjmrpbw4/image/upload/v1566494521/07%20R%20SQL%20p2/join_left_cropped.gif" style="width:60.0%" />
</center>
<div id="example-1.2" class="section level5">
<h5>Example 1.2:</h5>
<p>In the example above we wanted to see the names customers in the <em>customers</em> table who had a corresponding order in the <em>orders</em> table. But what if we wanted to see names of <strong>all</strong> customers and their order information, even if they don’t have any orders?</p>
<p>This is an example of a left join. We can do this using <code>LEFT JOIN</code> in SQL and <code>left_join</code> in R, as follows:</p>
<p><em>With SQL:</em></p>
<pre class="markdown"><code>SELECT 
  c.customerNumber, 
  c.customerName, 
  o.orderNumber, 
  o.status
FROM  
  customers AS c
  LEFT JOIN 
  orders AS o
    ON c.customerNumber = o.customerNumber
ORDER BY customerName</code></pre>
<p><em>With R:</em></p>
<pre class="r"><code>customers %&gt;% 
  left_join(orders, by = &quot;customerNumber&quot;) %&gt;% 
  select(customerNumber, customerName, orderNumber, status) %&gt;% 
  arrange(customerName)</code></pre>
<p>This returns 350 records, the first 50 of which are shown in the table below. If you scroll down, you will see that some customers have ‘NA’ for <em>orderNumber</em> and <em>status</em> (this will appear as ‘NULL’ in MySQL). These are customers who had no corresponding orders in the <em>orders</em> table. Note that each customer will appear more than once if they have more than one order.</p>
<br>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:right;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
customerNumber
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
customerName
</th>
<th style="text-align:right;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
orderNumber
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
status
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
242
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
<td style="text-align:right;">
10136
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
242
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
<td style="text-align:right;">
10178
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
242
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
<td style="text-align:right;">
10397
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
168
</td>
<td style="text-align:left;">
American Souvenirs Inc
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
249
</td>
<td style="text-align:left;">
Amica Models &amp; Co. 
</td>
<td style="text-align:right;">
10280
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
249
</td>
<td style="text-align:left;">
Amica Models &amp; Co. 
</td>
<td style="text-align:right;">
10293
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
237
</td>
<td style="text-align:left;">
ANG Resellers
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10148
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10169
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10370
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
276
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
<td style="text-align:right;">
10391
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
465
</td>
<td style="text-align:left;">
Anton Designs, Ltd. 
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
206
</td>
<td style="text-align:left;">
Asian Shopping Network, Co
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
348
</td>
<td style="text-align:left;">
Asian Treasures, Inc. 
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
Atelier graphique
</td>
<td style="text-align:right;">
10123
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
Atelier graphique
</td>
<td style="text-align:right;">
10298
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
103
</td>
<td style="text-align:left;">
Atelier graphique
</td>
<td style="text-align:right;">
10345
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
471
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
<td style="text-align:right;">
10193
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
471
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
<td style="text-align:right;">
10265
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
471
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
<td style="text-align:right;">
10415
</td>
<td style="text-align:left;">
Disputed
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10120
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10125
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10223
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10342
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
114
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
<td style="text-align:right;">
10347
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
<td style="text-align:right;">
10152
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
<td style="text-align:right;">
10174
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
333
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
<td style="text-align:right;">
10374
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
198
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
<td style="text-align:right;">
10130
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
198
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
<td style="text-align:right;">
10290
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
198
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
<td style="text-align:right;">
10352
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
256
</td>
<td style="text-align:left;">
Auto Associés &amp; Cie.
</td>
<td style="text-align:right;">
10216
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
256
</td>
<td style="text-align:left;">
Auto Associés &amp; Cie.
</td>
<td style="text-align:right;">
10304
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
406
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
<td style="text-align:right;">
10211
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
406
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
<td style="text-align:right;">
10252
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
406
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
<td style="text-align:right;">
10402
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
<td style="text-align:right;">
10110
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
<td style="text-align:right;">
10306
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
187
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
<td style="text-align:right;">
10332
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10103
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10158
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10309
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
121
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
<td style="text-align:right;">
10325
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
415
</td>
<td style="text-align:left;">
Bavarian Collectables Imports, Co. 
</td>
<td style="text-align:right;">
10296
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
293
</td>
<td style="text-align:left;">
BG&amp;E Collectables
</td>
<td style="text-align:right;">
NA
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10101
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10230
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10300
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
128
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
<td style="text-align:right;">
10323
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
<tr>
<td style="text-align:right;">
219
</td>
<td style="text-align:left;">
Boards &amp; Toys Co. 
</td>
<td style="text-align:right;">
10154
</td>
<td style="text-align:left;">
Shipped
</td>
</tr>
</tbody>
</table>
</div>
<a href="#contents"><em>(Top)</em></a>
<hr>
</div>
</div>
<div id="part1_3" class="section level4">
<h4>1.3 Right join</h4>
<p>A right join (or outer right join) returns all rows from <em>y</em>, and all columns from <em>x</em> and <em>y</em>. Rows in <em>y</em> with no match in <em>x</em> will have NA or NULL values in the new columns.</p>
<center>
<img src="https://res.cloudinary.com/ddjmrpbw4/image/upload/v1566503766/07%20R%20SQL%20p2/join_right_cropped.gif" style="width:60.0%" />
</center>
<p>This is exactly the same as a left join, described in the section above, but this time we’re returning all rows from the <em>right-hand</em> table (in this case, <em>y</em>) rather than those from the left-hand table.</p>
<p>A right join in which <em>y</em> is designated as the right-hand table (as in the animation above) would give <em>exactly the same result</em> as a left join in which <em>y</em> was designated as the left-hand table. The choice of whether a table is designated on the left or the right is entirely arbitrary.</p>
<p>Right joins can be carried out using <code>RIGHT JOIN</code> in SQL and <code>right_join</code> in R. No example is provided here given the similarity to left joins.</p>
<a href="#contents"><em>(Top)</em></a>
<hr>
</div>
<div id="part1_4" class="section level4">
<h4>1.4 Full join</h4>
<p>A full join (or full outer join) returns all rows and all columns from both <em>x</em> and <em>y</em>. Where there is no match for a particular key value, the missing values will appear as NA or NULL.</p>
<p><br></p>
<center>
<img src="https://res.cloudinary.com/ddjmrpbw4/image/upload/v1566496834/07%20R%20SQL%20p2/join_full_cropped.gif" style="width:60.0%" />
</center>
<p>Full joins are not actually supported in MySQL. However, a full join is equivalent to a <em>combination</em> of a left join and right join, as described above. To combine the results of these two joins, we need to use <strong>union</strong>.</p>
<p><strong>Union</strong> returns all unique rows from tables <em>x</em> and <em>y</em> as follows:</p>
<center>
<img src="https://res.cloudinary.com/ddjmrpbw4/image/upload/v1566501323/07%20R%20SQL%20p2/union.gif" style="width:60.0%" />
</center>
<div id="example-1.4" class="section level5">
<h5>Example 1.4:</h5>
<p>Say we want to list the name of every employee from the <em>employees</em> table, and every customer from the <em>customers</em> table. Where possible, we want to match the name of each employee to his/her customers. However we also want to return the names of all employees without customers, and the names of all customers without an associated employee. This is an example of a full join.</p>
<p>Assume that we want our query to return:</p>
<ul>
<li>each employee’s last name</li>
<li>each employee’s first name</li>
<li>each customer’s name</li>
</ul>
<p><em>With SQL:</em></p>
<p>To simulate a full join in SQL, we are going to use a <code>LEFT JOIN</code>, a <code>RIGHT JOIN</code> and the <code>UNION</code> of the two, as follows:</p>
<pre class="markdown"><code>SELECT 
  e.lastName, e.firstName, c.customerName 
FROM 
  employees AS e
  LEFT JOIN 
  customers AS c 
    ON e.employeeNumber = c.salesRepEmployeeNumber

UNION

SELECT 
  e.lastName, e.firstName, c.customerName 
FROM 
  employees AS e
  RIGHT JOIN 
  customers AS c 
    ON e.employeeNumber = c.salesRepEmployeeNumber</code></pre>
<p><em>With R:</em></p>
<p>In R, the syntax is much simpler as we can use <code>full_join</code>:</p>
<pre class="r"><code>employees %&gt;% 
  full_join(customers, by = c(&#39;employeeNumber&#39; = &#39;salesRepEmployeeNumber&#39;)) %&gt;% 
  select(lastName, firstName, customerName)</code></pre>
<p>The two sets of code above return the following 130 records. As expected, this shows the name of each employee matched to their customer(s), where such a match exists, but also the names of each employee and customer even if there is no match:</p>
<br>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:200px; ">
<table class="table" style="font-size: 11px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
lastName
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
firstName
</th>
<th style="text-align:left;font-size: 9px;position: sticky; top:0; background-color: #FFFFFF;">
customerName
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Murphy
</td>
<td style="text-align:left;">
Diane
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Mary
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Jeff
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
William
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Bow
</td>
<td style="text-align:left;">
Anthony
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Mini Gifts Distributors Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Mini Wheels Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Technics Stores Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Corporate Gift Ideas Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
The Sharp Gifts Warehouse
</td>
</tr>
<tr>
<td style="text-align:left;">
Jennings
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Signal Collectibles Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Signal Gift Stores
</td>
</tr>
<tr>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Toys4GrownUps.com
</td>
</tr>
<tr>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Boards &amp; Toys Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Collectable Mini Designs Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
Men ‘R’ US Retailers, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Thompson
</td>
<td style="text-align:left;">
Leslie
</td>
<td style="text-align:left;">
West Coast Collectables Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Cambridge Collectables Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Online Mini Collectables
</td>
</tr>
<tr>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Mini Creations Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Classic Gift Ideas, Inc
</td>
</tr>
<tr>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Collectables For Less Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Firrelli
</td>
<td style="text-align:left;">
Julie
</td>
<td style="text-align:left;">
Diecast Collectables
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Diecast Classics Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Auto-Moto Classics Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Marta’s Replicas Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Gifts4AllAges.com
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
Online Diecast Creations Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Patterson
</td>
<td style="text-align:left;">
Steve
</td>
<td style="text-align:left;">
FunGiftIdeas.com
</td>
</tr>
<tr>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Muscle Machine Inc
</td>
</tr>
<tr>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
American Souvenirs Inc
</td>
</tr>
<tr>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Vitachrome Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Québec Home Shopping Network
</td>
</tr>
<tr>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Classic Legends Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Super Scale Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Tseng
</td>
<td style="text-align:left;">
Foon Yue
</td>
<td style="text-align:left;">
Microscale Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Land of Toys Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Gift Depot Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Canadian Gift Exchange Network
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Royal Canadian Collectables, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Mini Classics
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Tekni Collectables Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Gift Ideas Corp. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Vanauf
</td>
<td style="text-align:left;">
George
</td>
<td style="text-align:left;">
Motor Mint Distributors Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Saveley &amp; Henriot, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
La Corne D’abondance, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Lyon Souveniers
</td>
</tr>
<tr>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Marseille Mini Autos
</td>
</tr>
<tr>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Reims Collectables
</td>
</tr>
<tr>
<td style="text-align:left;">
Bondur
</td>
<td style="text-align:left;">
Loui
</td>
<td style="text-align:left;">
Auto Canal+ Petit
</td>
</tr>
<tr>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Atelier graphique
</td>
</tr>
<tr>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
La Rochelle Gifts
</td>
</tr>
<tr>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Euro+ Shopping Channel
</td>
</tr>
<tr>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Daedalus Designs Imports
</td>
</tr>
<tr>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Mini Caravy
</td>
</tr>
<tr>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Alpha Cognac
</td>
</tr>
<tr>
<td style="text-align:left;">
Hernandez
</td>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Auto Associés &amp; Cie.
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Danish Wholesale Imports
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Heintze Collectables
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Amica Models &amp; Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Rovelli Gifts
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Petit Auto
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Royale Belge
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Salzburg Collectables
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
L’ordine Souveniers
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Mini Auto Werke
</td>
</tr>
<tr>
<td style="text-align:left;">
Castillo
</td>
<td style="text-align:left;">
Pamela
</td>
<td style="text-align:left;">
Frau da Collezione
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Toys of Finland, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
AV Stores, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
UK Collectables, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
giftsbymail.co.uk
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Oulu Toy Supplies, Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Stylish Desk Decors, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Suominen Souveniers
</td>
</tr>
<tr>
<td style="text-align:left;">
Bott
</td>
<td style="text-align:left;">
Larry
</td>
<td style="text-align:left;">
Double Decker Gift Stores, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Baane Mini Imports
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Blauer See Auto, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Volvo Model Replicas, Co
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Herkku Gifts
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Clover Collections, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Toms Spezialitäten, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Norway Gifts By Mail, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Bavarian Collectables Imports, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Jones
</td>
<td style="text-align:left;">
Barry
</td>
<td style="text-align:left;">
Scandinavian Gift Ideas
</td>
</tr>
<tr>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Australian Collectors, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Anna’s Decorations, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Souveniers And Things Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Australian Gift Network, Co
</td>
</tr>
<tr>
<td style="text-align:left;">
Fixter
</td>
<td style="text-align:left;">
Andy
</td>
<td style="text-align:left;">
Australian Collectables, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Handji Gifts&amp; Co
</td>
</tr>
<tr>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Down Under Souveniers, Inc
</td>
</tr>
<tr>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
GiftsForHim.com
</td>
</tr>
<tr>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Extreme Desk Decorations, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Marsh
</td>
<td style="text-align:left;">
Peter
</td>
<td style="text-align:left;">
Kelly’s Gift Shop
</td>
</tr>
<tr>
<td style="text-align:left;">
King
</td>
<td style="text-align:left;">
Tom
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Dragon Souveniers, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Osaka Souveniers Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
King Kong Collectables, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Cruz &amp; Sons Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
Nishi
</td>
<td style="text-align:left;">
Mami
</td>
<td style="text-align:left;">
Tokyo Collectables, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Kato
</td>
<td style="text-align:left;">
Yoshimi
</td>
<td style="text-align:left;">
NA
</td>
</tr>
<tr>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Enaco Distributors
</td>
</tr>
<tr>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Vida Sport, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
CAF Imports
</td>
</tr>
<tr>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Precious Collectables
</td>
</tr>
<tr>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Corrida Auto Replicas, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
Gerard
</td>
<td style="text-align:left;">
Martin
</td>
<td style="text-align:left;">
Iberia Gift Imports, Corp. 
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Havel &amp; Zbyszek Co
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Porto Imports Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Asian Shopping Network, Co
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Natürlich Autos
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
ANG Resellers
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Messner Shopping Network
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Franken Gifts, Co
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
BG&amp;E Collectables
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Schuyler Imports
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Der Hund Imports
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Cramer Spezialitäten, Ltd
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Asian Treasures, Inc. 
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
SAR Distributors, Co
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Kommission Auto
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Lisboa Souveniers, Inc
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Stuttgart Collectable Exchange
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Feuer Online Stores, Inc
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Warburg Exchange
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Anton Designs, Ltd. 
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Mit Vergnügen &amp; Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Kremlin Collectables, Co. 
</td>
</tr>
<tr>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Raanan Stores, Inc
</td>
</tr>
</tbody>
</table>
</div>
<a href="#contents"><em>(Top)</em></a>
<hr>
</div>
</div>
</div>
<div id="part2" class="section level1">
<h1>2. Grouped data</h1>
<p>In SQL and R, it is possible to <strong>group</strong> a set of rows into a summary row. This summary row can include an aggregate measure of each group; for example, the sum, the average, or the count of records in each group.</p>
<p>It is also possible to <em>filter</em> the data based on these aggregates. For example, you could filter to only show rows from groups with more than 20 records, or only show rows from groups where the average value of a certain variable was greater than 100.</p>
<hr>
<div id="part2_1" class="section level4">
<h4>2.1 Summarizing grouped data</h4>
<p>Grouped data is often summarized using aggregate functions such as <code>SUM</code>, <code>AVG</code>, <code>MAX</code>, <code>MIN</code> and <code>COUNT</code>. Here we look at a couple of examples using our sample database.</p>
<div id="example-a" class="section level5">
<h5>Example A</h5>
<p>Say we want to find the total value (in $) of each order in our sample data set.</p>
<p>To do this, we need to (1) calculate the value of each product in every order, i.e. the quantity times the price; and (2) group each product by its order number and add these values together.</p>
<p><em>With SQL:</em></p>
<p>In SQL we group the data using the <code>GROUP BY</code> clause, and specify our aggregate calculation in the <code>SELECT</code> clause, as follows:</p>
<pre class="markdown"><code>SELECT 
  orderNumber,
  SUM(quantityOrdered * priceEach) AS value
FROM 
  orderdetails
GROUP BY 
  orderNumber</code></pre>
<p><em>With R:</em></p>
<p>In R, we would use <code>group_by()</code> to group the data, and <code>summarize()</code> to apply the aggregate function to each group:</p>
<pre class="r"><code>orderdetails %&gt;% 
  group_by(orderNumber) %&gt;% 
  summarize(value = sum(quantityOrdered * priceEach)) %&gt;% 
  select(orderNumber, value)</code></pre>
The first 10 records (out of 326) are shown in the table below:
<table class="table table" style="font-size: 11px; margin-left: auto; margin-right: auto; width: auto !important; ">
<thead>
<tr>
<th style="text-align:right;font-size: 9px;">
orderNumber
</th>
<th style="text-align:right;font-size: 9px;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10100
</td>
<td style="text-align:right;">
10223.83
</td>
</tr>
<tr>
<td style="text-align:right;">
10101
</td>
<td style="text-align:right;">
10549.01
</td>
</tr>
<tr>
<td style="text-align:right;">
10102
</td>
<td style="text-align:right;">
5494.78
</td>
</tr>
<tr>
<td style="text-align:right;">
10103
</td>
<td style="text-align:right;">
50218.95
</td>
</tr>
<tr>
<td style="text-align:right;">
10104
</td>
<td style="text-align:right;">
40206.20
</td>
</tr>
<tr>
<td style="text-align:right;">
10105
</td>
<td style="text-align:right;">
53959.21
</td>
</tr>
<tr>
<td style="text-align:right;">
10106
</td>
<td style="text-align:right;">
52151.81
</td>
</tr>
<tr>
<td style="text-align:right;">
10107
</td>
<td style="text-align:right;">
22292.62
</td>
</tr>
<tr>
<td style="text-align:right;">
10108
</td>
<td style="text-align:right;">
51001.22
</td>
</tr>
<tr>
<td style="text-align:right;">
10109
</td>
<td style="text-align:right;">
25833.14
</td>
</tr>
</tbody>
</table>
</div>
<div id="example-b" class="section level5">
<h5>Example B</h5>
<p>We can also group using an <em>expression</em> rather than values that already exist in a column.</p>
<p>For example, say we wanted to find the total value of orders in each year, where the order has been shipped.</p>
<p>To do this, we need to do a combination of the following:</p>
<ul>
<li>Join the <em>orders</em> table, which has the date of each order, with the <em>orderdetails</em> table, which contains information on the quantity and price of the products ordered</li>
<li>Use the <code>YEAR()</code> function in SQL, and <code>year()</code> in R (using the <a href="https://lubridate.tidyverse.org/">lubridate</a> package), which the returns the year corresponding to each order date. This is will be used to group the data</li>
<li>Filter the data to only include orders whose status is ‘shipped’.</li>
</ul>
<p>This can be done in the following code:</p>
<p><em>With SQL:</em></p>
<pre class="markdown"><code>SELECT 
  YEAR(orderDate) AS year,
  SUM(quantityOrdered * priceEach) AS value
FROM
  orders
  INNER JOIN
  orderdetails 
    USING (orderNumber)
WHERE
  status = &#39;Shipped&#39;
GROUP BY 
  YEAR(orderDate)</code></pre>
<p><em>With R:</em></p>
<pre class="r"><code>orders %&gt;% 
  inner_join(orderdetails, by = &#39;orderNumber&#39;) %&gt;%
  filter(status == &#39;Shipped&#39;) %&gt;% 
  group_by(year = lubridate::year(orderDate)) %&gt;%
  summarize(value = sum(quantityOrdered * priceEach))</code></pre>
<p>Which gives the total value of shipped orders for the three years:</p>
<table class="table table" style="font-size: 11px; margin-left: auto; margin-right: auto; width: auto !important; ">
<thead>
<tr>
<th style="text-align:right;font-size: 9px;">
year
</th>
<th style="text-align:right;font-size: 9px;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
2003
</td>
<td style="text-align:right;">
3223096
</td>
</tr>
<tr>
<td style="text-align:right;">
2004
</td>
<td style="text-align:right;">
4300603
</td>
</tr>
<tr>
<td style="text-align:right;">
2005
</td>
<td style="text-align:right;">
1341396
</td>
</tr>
</tbody>
</table>
<a href="#contents"><em>(Top)</em></a>
<hr>
</div>
</div>
<div id="part2_2" class="section level4">
<h4>2.2 Filtering grouped data</h4>
<p>In SQL and R we can specify filter conditions for a group of rows. This assumes that we have already grouped our data using <code>GROUP BY</code> in SQL or <code>group_by()</code> in R.</p>
<p>When filtering grouped data in SQL we use the <code>HAVING</code> clause. Note that we do not use the <code>WHERE</code> clause, which is only used to filter ungrouped data.</p>
<p>In R, we filter our grouped data using <code>filter()</code>, which was also used with ungrouped data.</p>
<div id="example-a-1" class="section level5">
<h5>Example A</h5>
<p>Say we want to show all order numbers in which more than 650 individual items were ordered. This requires us to group by order number (<em>orderNumber</em>) from the <em>orderdetails</em> table, and to filter the results based on the total quantity of products in each order.</p>
<p><em>With SQL:</em></p>
<p>In SQL we apply our filter using the <code>HAVING</code> clause, as follows:</p>
<pre class="markdown"><code>SELECT 
  orderNumber, 
  sum(quantityOrdered) as quantity
FROM
  orderdetails
GROUP BY 
  orderNumber
HAVING 
  sum(quantityOrdered) &gt; 650
ORDER BY 
  quantity DESC</code></pre>
<p><em>With R:</em></p>
<p>With R, we use the <code>filter()</code> function:</p>
<pre class="r"><code>orderdetails %&gt;% 
  group_by(orderNumber) %&gt;% 
  summarize(quantity = sum(quantityOrdered)) %&gt;% 
  filter(quantity &gt; 650) %&gt;% 
  arrange(desc(quantity)) </code></pre>
<p>This gives the following three orders with more than 650 items:</p>
<table class="table table" style="font-size: 11px; margin-left: auto; margin-right: auto; width: auto !important; ">
<thead>
<tr>
<th style="text-align:right;font-size: 9px;">
orderNumber
</th>
<th style="text-align:right;font-size: 9px;">
quantity
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
10222
</td>
<td style="text-align:right;">
717
</td>
</tr>
<tr>
<td style="text-align:right;">
10106
</td>
<td style="text-align:right;">
675
</td>
</tr>
<tr>
<td style="text-align:right;">
10165
</td>
<td style="text-align:right;">
670
</td>
</tr>
</tbody>
</table>
</div>
<div id="example-b-1" class="section level5">
<h5>Example B</h5>
<p>Assume we want to find customers with an average order value over $3,800, for orders that have been shipped.</p>
<p>This example is slightly more complex as we need to join three tables, as follows:</p>
<p><em>With SQL:</em></p>
<pre class="markdown"><code>SELECT 
  a.customerName,
  b.status,
  avg(c.quantityOrdered * c.priceEach) as avg_value
FROM
  customers a
  INNER JOIN
  orders b 
    USING (customerNumber)
  INNER JOIN
  orderdetails c 
    USING (orderNumber)
GROUP BY 
  customerName, status
HAVING 
  avg_value &gt; 3800 AND status = &#39;Shipped&#39;
ORDER BY 
  avg_value DESC</code></pre>
<p>Note that in MySQL we can use the alias for average value (<em>avg_value</em>) in the <code>HAVING</code> clause, which was defined in the <code>SELECT</code> clause. Apparently not all versions of SQL support the use of aliases in the <code>HAVING</code> clause.</p>
<p><em>With R:</em></p>
<pre class="r"><code>customers %&gt;% 
  left_join(orders, by = &#39;customerNumber&#39;) %&gt;% 
  left_join(orderdetails, by = &#39;orderNumber&#39;) %&gt;% 
  group_by(customerName, status) %&gt;% 
  summarize(avg_value = mean(quantityOrdered * priceEach)) %&gt;% 
  filter(avg_value &gt; 3800 &amp; status == &#39;Shipped&#39;) %&gt;% 
  arrange(desc(avg_value))</code></pre>
We find that the following five customers have average shipped order sizes that are over $3,800:
<table class="table table" style="font-size: 11px; margin-left: auto; margin-right: auto; width: auto !important; ">
<thead>
<tr>
<th style="text-align:left;font-size: 9px;">
customerName
</th>
<th style="text-align:left;font-size: 9px;">
status
</th>
<th style="text-align:right;font-size: 9px;">
avg_value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Tekni Collectables Inc. 
</td>
<td style="text-align:left;">
Shipped
</td>
<td style="text-align:right;">
4253.501
</td>
</tr>
<tr>
<td style="text-align:left;">
Super Scale Inc. 
</td>
<td style="text-align:left;">
Shipped
</td>
<td style="text-align:right;">
4139.921
</td>
</tr>
<tr>
<td style="text-align:left;">
UK Collectables, Ltd. 
</td>
<td style="text-align:left;">
Shipped
</td>
<td style="text-align:right;">
4077.812
</td>
</tr>
<tr>
<td style="text-align:left;">
Mini Caravy
</td>
<td style="text-align:left;">
Shipped
</td>
<td style="text-align:right;">
3992.596
</td>
</tr>
<tr>
<td style="text-align:left;">
Gift Depot Inc. 
</td>
<td style="text-align:left;">
Shipped
</td>
<td style="text-align:right;">
3816.985
</td>
</tr>
</tbody>
</table>
<a href="#contents"><em>(Top)</em></a>
<hr>
</div>
</div>
</div>
