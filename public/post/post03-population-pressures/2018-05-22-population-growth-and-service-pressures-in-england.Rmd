---
title: 'Population growth and service pressures in England'
Summary: 'Population projections show rapid growth across England, paricularly among older adults. Discussion naturally focuses on the cost implications for older adult social care. This analysis shows that councils spending pressures reflect are more likely to reflect overall population growth' 
author: 'Steve Doogue'
date: '2018-05-27'
slug: population-growth-and-pressure
categories: []
tags: []
thumbnailImagePosition: "left"
thumbnailImage: //res.cloudinary.com/ddjmrpbw4/image/upload/v1523463010/population600.jpg
comments: true

---


Here we look at projected population growth between 2013 and 2025.^[Population figures from 2013 to 2016 are estimates, based on known rates of births, deaths and net migration. Figures from 2016 to 2025 are projections, which assume a continuation of these recent demographic trends.] We use 2013 as the starting point, as this was the most recent year in which the UK government carried out an assessment of local councils' relative funding needs. All else being equal, councils with faster population growth will be experiencing greater delivery pressures. 

```{r, echo = FALSE, results = 'hide', message = FALSE, warning = FALSE}
# PACKAGES ----

library(tidyverse)
library(readxl)
library(scales)
library(ggridges)
library(ggrepel)
library(plotly)

# For the mapping:
library(geojsonio)
library(leaflet)
library(spdplyr) # Allows you to manipulate spatial data frame using dplyr verbs

```
```{r, echo = FALSE, message = FALSE}
# LOAD AND ORGANISE DATA ----

# Clear workspace

rm(list = ls())

# Read in population data
df_pop <-   read_csv('data/pop_data.csv') 

# Read in local authority information data and change data types
df_info <-  read_xlsx('data/la_info.xlsx') %>%
            mutate_at(vars(5:6,8),as.factor) 

  # Change factor levels
  df_info$admin <- fct_collapse(df_info$admin, London = c('ILB','OLB'))
  df_info$admin <- fct_relevel(df_info$admin, 'London', 'County', 'Unitary', 'MD') 
  df_info$admin <- recode(df_info$admin, 'MD' = 'Met', 'SD' = 'Shire district')

# Read in spending data
df_spend <- read_xlsx('data/spending.xlsx') %>%
            filter(name != 'Iles of Scilly') %>% 
  
            # Gather age bands into single column
            gather(age_band,share,`0_17`:`all`) %>%
            arrange(code_mhclg) %>%
  
            # Create an ID column, based on authorty code and age band
            unite(id, code_mhclg, age_band,sep = " ", remove = FALSE) %>%
            select(-id,id)

```
```{r, echo = FALSE}

# DATAFRAMES TO BE USED

# Merge the population data with spending shares and LA info

df_pop0 <- df_pop %>%
            
            # Create an ID column, based on authority code and age band
            unite(id, code_mhclg, age_band,sep = " ", remove = FALSE) %>%
  
            # Add the spending share from df_spend table (this is the same for every year)
            left_join(select(df_spend, id, share), by = 'id') %>%
            select(-id) %>% 
            
            # Add authority names and admin type from the df_info table
            left_join(select(df_info, code_mhclg, name, admin), by = 'code_mhclg') %>% 
  
            # Create user-friendly labels with the variable 'age_band2'
            mutate(age_band2 = case_when(
              age_band == '0_17' ~ 'Children',
              age_band == '18_64' ~'Younger Adults',
              age_band == '65plus' ~ 'Older Adults',
              age_band == 'all' ~'All Ages')
            ) %>% 
            mutate(age_band2 = 
              factor(age_band2, levels = c('Older Adults', 'Younger Adults' ,'Children','All Ages'))
              ) %>% 
          
            # Restrict years to 2025 and earlier. Remove outliers, missing data
            select(code_mhclg, name, admin, year, age_band, age_band2, everything()) %>% 
            filter(year <= 2025,
                   name != 'City of London' & name != 'Isles of Scilly')

# POPULATION GROWTH INDICES FOR:

# 1 - Individual council by year and age band. Unweighted.

df_pop1 <- df_pop0 %>%
            arrange(code_mhclg, year) %>%
            group_by(code_mhclg, age_band) %>% 
            mutate(change_unweighted = (number - first(number))/first(number) +1) %>%
            ungroup()

# 2 - Individual council by year. Unweighted and weighted age bands.

df_pop2 <- df_pop1 %>%
            group_by(code_mhclg, name, admin, year) %>% 
            summarise(change_weighted = sum(change_unweighted * share),
                      change_unweighted = change_unweighted[age_band == 'all']
                      ) %>%
            ungroup()


```

```{r, echo = FALSE, message = FALSE}

# colorscheme <- c("#1569C7", "#f46d43", "#fec44f", "#1a9850", "red")
# 
# plotdata_1 <- df_pop3 %>% 
#   filter(year == '2025') %>% 
#   mutate(change_weighted = change_weighted -1) %>%   
#   mutate(change_unweighted = change_unweighted -1)
#   
# 
# px <- ggplot(plotdata_1, aes(x = change_unweighted, 
#                        y = admin, fill = admin,
#                        color = admin, 
#                        point_color = admin)) +
#   geom_density_ridges(jittered_points = TRUE, 
#                       alpha = .3, 
#                       scale =1) +
#   stat_density_ridges(quantile_lines = TRUE, 
#                       quantiles = 2,
#                       alpha = 0,
#                       scale = 1) +
#   scale_x_continuous(expand = c(0.01,0),
#                      name = 'Population change',
#                      labels= percent) +
#   scale_y_discrete(expand = c(0.01,0),
#                      name = '') +
#   # scale_fill_manual(values = colorscheme, guide = "none") +
#   # scale_color_manual(values = colorscheme, guide = "none") +
#   # scale_discrete_manual("point_color", values = colorscheme, guide = "none") +
#   theme_ridges(center = TRUE) +
#   theme(legend.position = 'none') +
#   ggtitle("Population growth between 2013 and 2025") 
# 
# px

```

Change in population between 2013 and 2025


***Fig 1: Projected population growth (2013 to 2025)***
```{r, echo = FALSE, message = FALSE, warning = FALSE}

colorscheme = c("#ef2929","#ad7fa8","#3465a4","#73d216","#f57900")
# http://tango.freedesktop.org/Tango_Icon_Theme_Guidelines

p1_data <- df_pop2 %>% 
  filter(year == '2025') %>% 
  mutate(change_weighted = change_weighted -1) %>%   
  mutate(change_unweighted = change_unweighted -1)

p1_label <- df_pop2 %>%
  filter(year == '2025') %>% 
  group_by(admin) %>%
  summarise(change_unweighted = median(change_unweighted) -1)
    

p1 <-  ggplot(data = p1_data, 
              aes(x = admin, 
                  y = change_unweighted, 
                  color = admin)) +  
        geom_jitter(aes(text = 
                        paste(name, 
                              '<br>', percent(change_unweighted))),
                    width = 0.2, size = 3, alpha = .7) + 
        stat_summary(fun.y = median, fun.ymin = median, fun.ymax = median,
                     geom = "crossbar", width = 0.5, color = 'black',aes(label=sprintf("%1.1f", ..x..))) +
        geom_hline(yintercept = 0, color = 'grey') + 
        scale_y_continuous(labels = percent) +
        theme_minimal() +
        theme(axis.title.y = element_blank(),
              axis.title.x = element_blank(),
              legend.position = "none",
              text=element_text(family= "arial")) +
        geom_text(data = p1_label, 
                  aes(x = admin, 
                      y = change_unweighted, 
                      label = percent(round(change_unweighted,3))),
                  color = "black",
                  position=position_nudge(x=0.4)) +
        scale_color_manual(values=colorscheme)


ggplotly(p1, tooltip = c("text")) %>%
  config(displayModeBar = FALSE)

```

These projections can be broken down by age band, to show the growth for children (ages 0 to 17), younger adults (ages 18 to 65) and older adults (ages 65 and over):

***Fig 2: Projected population growth by age band***
```{r, echo = FALSE, message = FALSE, warning = FALSE}

p2_data <- df_pop1 %>% 
  filter(year == '2025' & age_band != 'all') %>%
  mutate(change_unweighted = change_unweighted - 1)

p2_label <- df_pop1 %>% 
  filter(year == '2025'& age_band != 'all') %>% 
  group_by(admin,age_band2) %>%
  summarise(change_unweighted = median(change_unweighted) -1)

p2 <- ggplot(data = p2_data, 
             aes(x = admin,
                 y = change_unweighted, 
                 color = admin)) +  
    geom_jitter(aes(text = 
                    paste(name, 
                    '<br>', percent(change_unweighted))),
                width = 0.2, size = 1, alpha = .6) + 
    stat_summary(fun.y = median, fun.ymin = median, fun.ymax = median,
                 geom = "crossbar", width = 0.5, color = 'black') +
    facet_wrap(~ age_band2) +
    geom_hline(yintercept = 0, color = 'grey') + 
    scale_y_continuous(labels = percent) +
    theme_minimal() +
    theme(axis.text.x=element_text(angle = 90, hjust = 0),
          axis.title.y = element_blank(),
          axis.title.x = element_blank(),
          legend.position = "none",
          strip.background = element_rect(color = NA, fill="#f0f0f0"),
          text=element_text(family= "arial", size = 14)) +
    geom_text(data = p2_label, 
              aes(x = admin, 
                  y = change_unweighted, 
                  label = percent(round(change_unweighted,2))),
              color = "black",
              size = 3.5,
              position=position_nudge(y=0.03)) +
    scale_color_manual(values=colorscheme) 

ggplotly(p2, tooltip = c("text")) %>%
  config(displayModeBar = FALSE)
```
<br>
From the figure above, we can see that older adults are the fastest growing age group for all types of councils, followed by children . Younger adults are projected to grow relatively slowly. London stands out for the fact that it has the fastest population growth across all age categories, most notably for younger adults. 

So how does this translate to pressure on local services?  For example, older adults are likely to require more costly social care support (including care in residential and nursing homes) than younger adults. 

One option is to use weighted growth, based on councils' actual expenditure patterns. We make the following assumptions regarding the age bands specific to various services: 

* Older adult social services: people aged 65 plus
* Younger adult social services: people aged 18 to 64
* Children's social services: people aged 0 to 17
* All other services: people of all ages.

We exclude spending on schools, public health and highways & transport, which are outside of councils' core responsibilities or where spending is less likely to be determined by demographic growth. The breakdown of estimated expenditure by age group is illustrated below:

***Fig 3: Average expenditure share by age band***
```{r, echo = FALSE, message = FALSE, warning = FALSE}

# THIRD PLOT

# Calculate average spending share by admin group

df_plot3 <- df_pop0 %>%
             group_by(admin, age_band2) %>%
             summarise(share = mean(share)) %>%
             filter(admin != 'Shire district')

p3 <-  ggplot(data = df_plot3) + 
          geom_bar(aes(y = share, x = admin, fill = age_band2), alpha = .75, stat="identity") +
          geom_text(aes(y = share, x = admin, fill = age_band2, label = percent(round(share,2))), 
                    position = "stack", vjust = 2) + 
          theme_minimal() +
          scale_y_continuous(labels=percent) +
          labs(y = "Share of expenditure",
               subtitle = paste("Based on actual net current expenditure for 2014/15 to 2016/17")
               ) +
          theme(axis.title.x = element_blank(),
                panel.grid.major.x = element_blank(),
                axis.text.x = element_text(colour="black"),
                axis.text.y = element_blank(),
                legend.title=element_blank()) +
          scale_fill_manual(values = c('#2171b5','#6baed6','#bdd7e7','#969696'))
          
p3

# label = percent(round(share,2))), size = 3) +

```

Older adult social care accounts for less than a third of social care expenidture, on average. 

We create a single estimate of 'population pressure' by weighing population growth in each age band by its corresponding share of expenditure (for each individual council). 

***Fig 4: Population growth weighted by service expenditure (2013 to 2025)***
```{r, echo = FALSE, message = FALSE, warning = FALSE}
# FOURTH PLOT

# This is exactly the same as plot1 but uses weighted data

p4_data <- df_pop2 %>% 
  filter(year == '2025') %>% 
  mutate(change_weighted = change_weighted -1) %>%   
  mutate(change_unweighted = change_unweighted -1)

p4_label <- df_pop2 %>%
  filter(year == '2025') %>% 
  group_by(admin) %>%
  summarise(change_weighted = median(change_weighted) -1)
    

p4 <-  ggplot(data = p4_data, 
              aes(x = admin, 
                  y = change_weighted, 
                  color = admin)) +  
        geom_jitter(aes(text = 
                        paste(name, 
                              '<br>', percent(change_weighted))),
                    width = 0.2, size = 3, alpha = .7) + 
        stat_summary(fun.y = median, fun.ymin = median, fun.ymax = median,
                     geom = "crossbar", width = 0.5, color = 'black',aes(label=sprintf("%1.1f", ..x..))) +
        geom_hline(yintercept = 0, color = 'grey') + 
        scale_y_continuous(labels = percent) +
        theme_minimal() +
        theme(axis.title.y = element_blank(),
              axis.title.x = element_blank(),
              legend.position = "none",
              text=element_text(family= "arial")) +
        geom_text(data = p4_label, 
                  aes(x = admin, 
                      y = change_weighted, 
                      label = percent(round(change_weighted,3))),
                  color = "black",
                  position=position_nudge(x=0.4)) +
    scale_color_manual(values=colorscheme)

ggplotly(p4, tooltip = c("text")) %>%
  config(displayModeBar = FALSE)

```

Finally, we can illustrate how population pressure varies by geographic region. As can be seen, population pressures are greatest in the South, East and East Midlands.

***Fig 5: Weighted population growth (2013 to 2025)***
```{r, echo = FALSE, message = FALSE, warning = FALSE}

# CREATE A MAP

url_base <- "https://api.mapbox.com/styles/v1/steverd/cj79lzfne8a582spgrmb0otyr/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic3RldmVyZCIsImEiOiJ5T0hIMGU4In0.iRYeTkjtats3I4b2ZCBZVw"

map_county <- geojson_read('data/unitary_county_small.geojson', what = 'sp')
map_district <- geojson_read('data/unitary_district_small.geojson', what = 'sp')

temp <- df_pop2 %>%
        filter(year == 2025)

map_county <- map_county %>% 
              left_join(select(temp,code_mhclg,change_weighted), 
                        by = 'code_mhclg') %>%
              mutate(change_weighted = change_weighted -1)

map_district <- map_district %>% 
                left_join(select(temp, code_mhclg, change_weighted), 
                          by = 'code_mhclg') %>%
                mutate(change_weighted = change_weighted -1)

# Map 
#   For some reason the map crashes in R when switching between counties and districts, 
#   but it works in the browser 

colorsmap <- c("#74a9cf","#ffffb2","#fecc5c","#fd8d3c","#e31a1c")

bins <-  c(-Inf,0,0.05,0.1,0.2,Inf)
pal_county <- colorBin(colorsmap, domain = map_county$change_weighted, bins = bins)
pal_district <- colorBin(colorsmap, domain = map_district$change_weighted, bins = bins)
# pal_district <- colorBin("YlOrRd", domain = map_district$change_weighted, bins = bins)

leaflet() %>%
  addTiles(url_base) %>%
  # Unitaries & counties weighted
  addPolygons(data = map_county, 
              fillColor = ~pal_county(change_weighted),
              fillOpacity = 0.7,
              group = 'Unitaries & counties',
              label = paste(map_county$name,
                            percent(map_county$change_weighted)),
              color = 'white',
              weight = 2,
              highlightOptions = highlightOptions(color = "black", weight =4,
                                                  bringToFront = TRUE)) %>%
   # Unitaries & districts weighted
  addPolygons(data = map_district, 
              fillColor = ~pal_district(change_weighted),
              fillOpacity = 0.7,
              group = 'Unitaries & districts',
              label = paste(map_district$name, 
                            percent(map_district$change_weighted)),
              color = 'white',
              weight = 2,
              highlightOptions = highlightOptions(color = "black", weight = 4,
                                                  bringToFront = TRUE)) %>%
  # Layers control
  addLayersControl(
    baseGroups = c('Unitaries & districts','Unitaries & counties'),
    options = layersControlOptions(collapsed = FALSE)
  ) %>%
  # Add a legend
  addLegend(colors = colorsmap,
            labels= c("Reduction", "0% to 5%","5% to 10%","10% to 20%","Over 20%"),
            opacity = 0.5,
            title = "Change",
            position = "bottomright")


```



